# SSH

Telnet同様、遠隔コンピュータ操作するためのプロトコル。
Telnetと違い、通信が暗号化されている。

## 必要な物

- SSHサーバ(OpenSSHなど)

## 流れ

- クライアント側

  - キーペア(公開鍵・秘密鍵)を作成
  - サーバ側に公開鍵を送信

- サーバ側

  - クライアントから送られてきた公開鍵を保存(`~/.ssh/authorized_key`)

- 接続時

  - 接続要求がきたら保持してる公開鍵を元にフィンガープリントを作成
  - クライアント側のフィンガープリントと一致したら接続成立

  - フィンガープリントは鍵を元に生成されたハッシュ値
    - `ssh-keygen -lf [keyname]`で作成できる

## known_hostsとは？

- クライアント側に記録されるデータ
- 接続経験のあるホストのアドレスや公開鍵などがセットで記録される
- これがあることで、以前接続したホストの公開鍵が変わった際に検知することができる

## セキュリティのプラクティス

- SSH用のポートは変更しとく
- SSHログイン時、パスワード認証は使わない。公開鍵暗号方式を使う。
- ルートログインはできないように設定する。

## sshdとsshの違いは？

sshはクライアント側のプログラム。
sshdはサーバ側のデーモンプログラム。

ただ、ubuntuだとsshdのことをsshと呼んでるみたい。若干ややこしい。

## ssh.socketとは？

Ubuntu24.04で標準搭載されたソケットユニット(新機能)。
これまでは常にssh.serviceが起動していたが、ssh.socketがポートをリッスンし、
必要な時のみ、ssh.serviceを起動させるといった方式になった。

これにより、接続要求がない限り、SSHサーバーは起動しないため、不必要なリソースの使用を削減と、
セキュリティ面での向上ができる。
